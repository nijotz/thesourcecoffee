{% load jsonify %}

<script type="text/javascript">
$(function() {
  $('#amount_radios').buttonset();
  $('#interval_radios').buttonset();
});

function update_total() {
  var plans = {{plans|jsonify}};
  var amount = $('input:checked[name="amount"]').val();
  var interval = $('input:checked[name="interval"]').val();
  var price = plans[amount][interval];
  $('#signup_total').html('Grand Total: $' + price.toString());
}

$(function(){
  $("input[type='radio']").change(function(obj) {
    if ($('input:checked[name="amount"]').val() == 0.125) {
      $('input[name="interval"]').button({disabled:true});
      $('input[name="interval"]').prop('checked', false);
      $('#interval_radios').buttonset('refresh');
    }
    else {
      $('input[name="interval"]').button({disabled:false});
    }
    update_total();
  });
});

$(function(){
  update_total();
});
</script>

<div class="control-group input_id_plan">
<div class="center">
  <div id="amount_radios">
    {% for value, text in subscription_form.fields.amount.choices %}
    <input {% if subscription_form.amount.value == value %}checked="checked"{%endif%} id="amount_{{value}}" type="radio" value="{{value}}" name="amount"/>
    <label for="amount_{{value}}">{{text}}</label>
    {% endfor %}
  </div>
  <p class="content">
  How long do you want your subscription to last?
  </p>
  <div class="center">
    <div id="interval_radios">
    {% for value, text in subscription_form.fields.interval.choices %}
      <input {% if subscription_form.interval.value == value %}checked="checked"{%endif%} id="interval_{{value}}" type="radio" value="{{value}}" name="interval"/>
      <label for="interval_{{value}}">{{text}}</label>
    {% endfor %}
    </div>
  </div>
  <p class="content">
  *Please note that 3 month and 1 year subscriptions will only be cancelled after the subscription period has elapsed!*
  </p>
  </div>

<div class="control-group input_id_code">
    <label for="id_code" class="signup">Have a gift code?</label>
    <div class="controls">
        <input id="id_code" name="code" type="text" />
        <span class="help-inline"></span>
    <input type="submit" class="btn" value="Apply Code"></input>
    </div>
</div>

<h3 id="signup_total">Grand Total:</h3>
<script src="https://checkout.stripe.com/v2/checkout.js" class="stripe-button" data-key="pk_test_byUXCM2Jh3dR4GG5SbML95zn">
</script>
